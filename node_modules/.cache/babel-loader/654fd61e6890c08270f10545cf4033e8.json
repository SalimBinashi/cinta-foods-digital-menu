{"ast":null,"code":"\"use strict\";\n\nvar semver = require(\"semver\");\n\nvar arrayify = require(\"../utils/arrayify\");\n\nvar currentVersion = require(\"../../package.json\").version;\n\nvar coreOptions = require(\"./core-options\").options;\n\nfunction getSupportInfo(version, opts) {\n  opts = Object.assign({\n    plugins: [],\n    showUnreleased: false,\n    showDeprecated: false,\n    showInternal: false\n  }, opts);\n\n  if (!version) {\n    // pre-release version is smaller than the normal version in semver,\n    // we need to treat it as the normal one so as to test new features.\n    version = currentVersion.split(\"-\", 1)[0];\n  }\n\n  var plugins = opts.plugins;\n  var options = arrayify(Object.assign(plugins.reduce(function (currentOptions, plugin) {\n    return Object.assign(currentOptions, plugin.options);\n  }, {}), coreOptions), \"name\").sort(function (a, b) {\n    return a.name === b.name ? 0 : a.name < b.name ? -1 : 1;\n  }).filter(filterSince).filter(filterDeprecated).map(mapDeprecated).map(mapInternal).map(function (option) {\n    var newOption = Object.assign({}, option);\n\n    if (Array.isArray(newOption[\"default\"])) {\n      newOption[\"default\"] = newOption[\"default\"].length === 1 ? newOption[\"default\"][0].value : newOption[\"default\"].filter(filterSince).sort(function (info1, info2) {\n        return semver.compare(info2.since, info1.since);\n      })[0].value;\n    }\n\n    if (Array.isArray(newOption.choices)) {\n      newOption.choices = newOption.choices.filter(filterSince).filter(filterDeprecated).map(mapDeprecated);\n    }\n\n    return newOption;\n  }).map(function (option) {\n    var filteredPlugins = plugins.filter(function (plugin) {\n      return plugin.defaultOptions && plugin.defaultOptions[option.name] !== undefined;\n    });\n    var pluginDefaults = filteredPlugins.reduce(function (reduced, plugin) {\n      reduced[plugin.name] = plugin.defaultOptions[option.name];\n      return reduced;\n    }, {});\n    return Object.assign(option, {\n      pluginDefaults: pluginDefaults\n    });\n  });\n  var usePostCssParser = semver.lt(version, \"1.7.1\");\n  var useBabylonParser = semver.lt(version, \"1.16.0\");\n  var languages = plugins.reduce(function (all, plugin) {\n    return all.concat(plugin.languages || []);\n  }, []).filter(filterSince).map(function (language) {\n    // Prevent breaking changes\n    if (language.name === \"Markdown\") {\n      return Object.assign({}, language, {\n        parsers: [\"markdown\"]\n      });\n    }\n\n    if (language.name === \"TypeScript\") {\n      return Object.assign({}, language, {\n        parsers: [\"typescript\"]\n      });\n    } // \"babylon\" was renamed to \"babel\" in 1.16.0\n\n\n    if (useBabylonParser && language.parsers.indexOf(\"babel\") !== -1) {\n      return Object.assign({}, language, {\n        parsers: language.parsers.map(function (parser) {\n          return parser === \"babel\" ? \"babylon\" : parser;\n        })\n      });\n    }\n\n    if (usePostCssParser && (language.name === \"CSS\" || language.group === \"CSS\")) {\n      return Object.assign({}, language, {\n        parsers: [\"postcss\"]\n      });\n    }\n\n    return language;\n  });\n  return {\n    languages: languages,\n    options: options\n  };\n\n  function filterSince(object) {\n    return opts.showUnreleased || !(\"since\" in object) || object.since && semver.gte(version, object.since);\n  }\n\n  function filterDeprecated(object) {\n    return opts.showDeprecated || !(\"deprecated\" in object) || object.deprecated && semver.lt(version, object.deprecated);\n  }\n\n  function mapDeprecated(object) {\n    if (!object.deprecated || opts.showDeprecated) {\n      return object;\n    }\n\n    var newObject = Object.assign({}, object);\n    delete newObject.deprecated;\n    delete newObject.redirect;\n    return newObject;\n  }\n\n  function mapInternal(object) {\n    if (opts.showInternal) {\n      return object;\n    }\n\n    var newObject = Object.assign({}, object);\n    delete newObject.cliName;\n    delete newObject.cliCategory;\n    delete newObject.cliDescription;\n    return newObject;\n  }\n}\n\nmodule.exports = {\n  getSupportInfo: getSupportInfo\n};","map":null,"metadata":{},"sourceType":"script"}